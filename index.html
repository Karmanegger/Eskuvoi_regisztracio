<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Esküvői Regisztráció</title>
<link rel="stylesheet" href="style.css">
<style>
/* Ide bemásolhatod a korábbi style.css tartalmát, semmit sem változtattam */
</style>
</head>
<body>
<div class="container">
    <header>
        <h1>Esküvői Regisztráció</h1>
    </header>

    <div class="tabs">
        <div class="tab active" data-tab="registration">Regisztráció</div>
        <div class="tab" data-tab="participants">Résztvevők</div>
    </div>

    <div class="tab-content active" id="registration">
        <form id="guestForm">
            <label>Név:</label>
            <input type="text" id="name" required placeholder="Például: Kovács Anna">

            <label>Hányan érkeznek:</label>
            <input type="number" id="people" required min="1" value="1">

            <label>Szeretne ott aludni? Ha igen, hányan:</label>
            <input type="number" id="sleep" min="0" value="0">

            <label>Ételérzékenység:</label>
            <input type="text" id="food" placeholder="pl. glutén, laktóz">

            <label>Speciális igények:</label>
            <textarea id="special" rows="2" placeholder="pl. vegetáriánus, szobatárs, transzport"></textarea>

            <button type="submit">Mentés</button>
        </form>
    </div>

    <div class="tab-content" id="participants">
        <div class="delete-section">
            <label>Jelszó az adatok törléséhez:</label>
            <input type="password" id="deletePass" placeholder="Írd be a csigakaki jelszót">
            <button id="deleteBtn">Összes adat törlése</button>
        </div>

        <input type="text" id="search" placeholder="Keresés név vagy kategória szerint">

        <table id="participantsTable">
            <thead>
                <tr>
                    <th>Név</th>
                    <th>Hányan jönnek</th>
                    <th>Alvás</th>
                    <th>Ételérzékenység</th>
                    <th>Speciális igények</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>

<script>
// Firebase konfiguráció
const firebaseConfig = {
  apiKey: "AIzaSyC5A5bogaOqW6OKnUEzPxtFMadSiUj-2ZU",
  authDomain: "eskuvoiregisztracio.firebaseapp.com",
  projectId: "eskuvoiregisztracio",
  storageBucket: "eskuvoiregisztracio.firebasestorage.app",
  messagingSenderId: "113983296673",
  appId: "1:113983296673:web:b1f9a0c049bc42c6ab8ce0",
  measurementId: "G-2DJCG5N94C",
  databaseURL: "https://eskuvoiregisztracio-default-rtdb.europe-west1.firebasedatabase.app/"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Tab váltás
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const target = tab.dataset.tab;
        tabContents.forEach(tc => {
            tc.classList.remove('active');
            if(tc.id === target) tc.classList.add('active');
        });
    });
});

const form = document.getElementById('guestForm');
const tableBody = document.querySelector('#participantsTable tbody');
const deleteBtn = document.getElementById('deleteBtn');
const deletePass = document.getElementById('deletePass');
const searchInput = document.getElementById('search');
const PASSWORD = 'csigakaki';

// Adatok beküldése Firebase-be
form.addEventListener('submit', e => {
    e.preventDefault();
    const guest = {
        name: document.getElementById('name').value.trim(),
        people: document.getElementById('people').value,
        sleep: document.getElementById('sleep').value,
        food: document.getElementById('food').value.trim(),
        special: document.getElementById('special').value.trim()
    };
    db.ref('participants').push(guest);
    form.reset();
});

// Résztvevők listázása valós időben
db.ref('participants').on('value', snapshot => {
    tableBody.innerHTML = '';
    snapshot.forEach(childSnap => {
        const p = childSnap.val();
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${p.name}</td>
            <td>${p.people}</td>
            <td>${p.sleep}</td>
            <td>${p.food}</td>
            <td>${p.special}</td>
        `;
        tableBody.appendChild(row);
    });
});

// Keresés
searchInput.addEventListener('input', e => {
    const term = e.target.value.toLowerCase();
    const rows = tableBody.querySelectorAll('tr');
    rows.forEach(row => {
        row.style.display = [...row.cells].some(cell => cell.textContent.toLowerCase().includes(term)) ? '' : 'none';
    });
});

// Adatok törlése jelszóval
deleteBtn.addEventListener('click', () => {
    if(deletePass.value === PASSWORD){
        if(confirm('Biztosan törlöd az összes adatot?')){
            db.ref('participants').remove();
            deletePass.value = '';
        }
    } else alert('Helytelen jelszó!');
});
</script>
</body>
</html>
