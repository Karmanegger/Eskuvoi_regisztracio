<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Esküvői Regisztráció</title>
<style>
/* ---- Dizájn: fekete, ezüst, baba rózsaszín (kontraszthoz a szöveg kicsit eltérhet) ---- */
:root{
  --black:#000;
  --silver:#c0c0c0;
  --pink:#f7c2c2;
  --muted-bg: rgba(0,0,0,0.6);
  --card-bg: rgba(255,255,255,0.92);
  --text-dark: #111;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, Arial, sans-serif;
  background: linear-gradient(135deg, var(--black) 20%, #1a1a1a 50%, var(--pink) 120%);
  color:var(--pink);
  -webkit-font-smoothing:antialiased;
}
.container{max-width:1000px;margin:0 auto;padding:20px}
header{text-align:center;margin-bottom:18px}
h1{font-family:Georgia,serif;margin:0;color:var(--pink);font-size:2.25rem}
.tabs{display:flex;gap:10px;justify-content:center;margin-bottom:18px;flex-wrap:wrap}
.tab{
  padding:10px 18px;border-radius:10px;background:#222;color:var(--pink);cursor:pointer;font-weight:700;
  border:2px solid transparent; user-select:none;
}
.tab.active{background:var(--silver);color:var(--black);border-color:rgba(0,0,0,0.15);box-shadow:0 4px 14px rgba(0,0,0,0.4)}
.tab:focus{outline:3px solid rgba(255,194,194,0.12)}
.tab-content{display:none;background:var(--muted-bg);padding:18px;border-radius:12px}
.tab-content.active{display:block}

/* form */
form{display:flex;flex-direction:column;gap:12px;max-width:720px;margin:0 auto}
label{font-weight:700;color:var(--pink);display:block;margin-bottom:4px}
.input, input[type="text"], input[type="number"], textarea, select {
  width:100%;padding:10px;border-radius:8px;border:none;font-size:1rem;
  background:rgba(255,255,255,0.95);color:var(--text-dark);
}
textarea{min-height:68px;resize:vertical}
.row{display:flex;gap:12px}
.row .col{flex:1}

/* gomb */
button{background:var(--silver);color:var(--black);border:none;padding:12px;border-radius:8px;font-weight:800;cursor:pointer}
button:hover{background:var(--pink)}
.small{padding:8px 10px;font-size:0.95rem}

/* táblázat */
.table-wrap{overflow:auto;margin-top:12px}
table{width:100%;border-collapse:collapse;background:var(--card-bg);color:var(--text-dark);min-width:600px}
th,td{padding:10px;border:1px solid rgba(0,0,0,0.08);text-align:left}
th{background:#222;color:var(--pink);font-weight:700}
.search{max-width:720px;margin:12px auto 0}
.delete-section{max-width:720px;margin:14px auto 0;display:flex;gap:8px;align-items:center}

/* mobil */
@media (max-width:640px){
  .row{flex-direction:column}
  table{min-width:unset}
  .tabs{padding:6px}
}

/* segédszöveg */
.info{max-width:720px;margin:10px auto;color:rgba(247,194,194,0.95)}
</style>
</head>
<body>
<div class="container">
  <header><h1>Esküvői Regisztráció</h1></header>

  <div class="tabs" role="tablist" aria-label="Fül navigáció">
    <div class="tab active" role="tab" tabindex="0" data-tab="registration">Regisztráció</div>
    <div class="tab" role="tab" tabindex="0" data-tab="participants">Résztvevők</div>
  </div>

  <div id="registration" class="tab-content active" role="tabpanel">
    <form id="guestForm" autocomplete="off">
      <div class="row">
        <div class="col">
          <label for="name">Név</label>
          <input id="name" class="input" type="text" placeholder="Például: Kovács Anna" required>
        </div>
        <div class="col">
          <label for="people">Hányan érkeznek</label>
          <input id="people" class="input" type="number" min="1" value="1" required>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="sleep">Szeretne ott aludni?</label>
          <select id="sleep" class="input">
            <option value="Nem">Nem</option>
            <option value="Igen">Igen</option>
          </select>
        </div>
        <div class="col">
          <label for="sleepCount">Ha igen, hányan?</label>
          <input id="sleepCount" class="input" type="number" min="0" value="0">
        </div>
      </div>

      <label for="food">Ételérzékenység</label>
      <input id="food" class="input" type="text" placeholder="pl. glutén, laktóz">

      <label for="special">Speciális igények</label>
      <textarea id="special" class="input" placeholder="pl. vegetáriánus, szobatárs, transzport"></textarea>

      <div style="display:flex;gap:10px;align-items:center;margin-top:6px">
        <button id="saveBtn" class="small" type="submit">Mentés</button>
        <div style="flex:1"></div>
      </div>
      <p class="info">Az adatok mentése online történik — mások is látják a résztvevők fülön.</p>
    </form>
  </div>

  <div id="participants" class="tab-content" role="tabpanel" aria-hidden="true">
    <div class="delete-section">
      <input id="deletePass" class="input" type="password" placeholder="Írd be a csigakaki jelszót">
      <button id="deleteBtn" class="small">Összes adat törlése</button>
    </div>

    <div class="search">
      <input id="search" class="input" type="text" placeholder="Keresés név vagy kategória szerint">
    </div>

    <div class="table-wrap">
      <table id="participantsTable" aria-live="polite">
        <thead>
          <tr>
            <th>Név</th><th>Hányan jönnek</th><th>Alvás</th><th>Ételérzékenység</th><th>Speciális igények</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Firebase SDK (compat könyvtár egyszerűbb, megbízható) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ======= Biztonsági megjegyzés =======
 * A következő konfiguráció a te projekthez tartozik (amit megadtál).
 * Ha nyilvános repo-ba teszed, ez publikus lesz — de read/write szabályokat
 * a Firebase Console-ban állíthatsz. Teszteléshez ez rendben van.
 * ======================================*/

// Firebase konfiguráció (a te korábbi értékeid)
const firebaseConfig = {
  apiKey: "AIzaSyC5A5bogaOqW6OKnUEzPxtFMadSiUj-2ZU",
  authDomain: "eskuvoiregisztracio.firebaseapp.com",
  databaseURL: "https://eskuvoiregisztracio-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "eskuvoiregisztracio",
  storageBucket: "eskuvoiregisztracio.appspot.com",
  messagingSenderId: "113983296673",
  appId: "1:113983296673:web:b1f9a0c049bc42c6ab8ce0"
};

// Inicializálás
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ======= Robust tab-váltás: DOMContentLoaded alatt inicializáljuk ======= */
(function(){
  function initTabs(){
    const tabs = Array.from(document.querySelectorAll('.tab'));
    const contents = Array.from(document.querySelectorAll('.tab-content'));

    function activate(tabEl){
      // Deactivate all
      tabs.forEach(t => t.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));
      // Activate chosen
      tabEl.classList.add('active');
      const target = tabEl.getAttribute('data-tab');
      const panel = document.getElementById(target);
      if(panel) panel.classList.add('active');
    }

    // ensure attribute mapping exists (data-tab must match id of panel)
    tabs.forEach(t => {
      t.addEventListener('click', () => activate(t));
      t.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); activate(t); }
      });
    });
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', initTabs);
  } else {
    initTabs();
  }
})();

/* ======= Main app logic ======= */
(function(){
  const form = document.getElementById('guestForm');
  const searchInput = document.getElementById('search');
  const tableBody = document.querySelector('#participantsTable tbody');
  const deleteBtn = document.getElementById('deleteBtn');
  const deletePass = document.getElementById('deletePass');
  const PASSWORD = 'csigakaki';

  // push new guest
  form.addEventListener('submit', e => {
    e.preventDefault();
    const guest = {
      name: document.getElementById('name').value.trim() || '(Név nélkül)',
      people: parseInt(document.getElementById('people').value) || 0,
      sleep: document.getElementById('sleep').value || 'Nem',
      sleepCount: parseInt(document.getElementById('sleepCount').value) || 0,
      food: document.getElementById('food').value.trim(),
      special: document.getElementById('special').value.trim(),
      createdAt: Date.now()
    };
    // egyszerű validálás
    if(!guest.name || guest.people < 1){ alert('Kérlek add meg a nevet és a résztvevők számát.'); return; }

    // mentés Firebase-be
    db.ref('participants').push(guest)
      .then(() => {
        // lépés: ha szeretnéd, automatikusan átvált a résztvevők fülre:
        // document.querySelector('.tab[data-tab="participants"]').click();
      })
      .catch(err => {
        console.error('Firebase write error:', err);
        alert('Hiba a mentés során. Nézd a konzolt.');
      });
    form.reset();
  });

  // valós idejű megjelenítés
  function renderSnapshot(snapshot){
    tableBody.innerHTML = '';
    snapshot.forEach(child => {
      const p = child.val();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(p.name || '')}</td>
        <td>${escapeHtml(String(p.people || ''))}</td>
        <td>${escapeHtml(p.sleep || '')} ${p.sleepCount ? '('+escapeHtml(String(p.sleepCount))+')' : ''}</td>
        <td>${escapeHtml(p.food || '')}</td>
        <td>${escapeHtml(p.special || '')}</td>`;
      tableBody.appendChild(tr);
    });
  }

  // listen
  db.ref('participants').on('value', snapshot => {
    // snapshot lehet üres
    renderSnapshot(snapshot);
  }, err => {
    console.error('Firebase read error:', err);
  });

  // keresés (client-side)
  searchInput.addEventListener('input', e => {
    const term = e.target.value.trim().toLowerCase();
    const rows = Array.from(tableBody.querySelectorAll('tr'));
    if(!term){
      rows.forEach(r => r.style.display = '');
      return;
    }
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(term) ? '' : 'none';
    });
  });

  // törlés jelszóval
  deleteBtn.addEventListener('click', () => {
    if(deletePass.value !== PASSWORD){ alert('Hibás jelszó!'); return; }
    if(!confirm('Biztosan törlöd az összes adatot?')) return;
    db.ref('participants').remove()
      .then(() => {
        deletePass.value = '';
        alert('Sikeresen törölve.');
      })
      .catch(err => {
        console.error('Firebase delete error:', err);
        alert('Hiba törlés közben.');
      });
  });

  // egyszerű HTML-escape segéd
  function escapeHtml(str){
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }
})(); // end main
</script>
</body>
</html>
